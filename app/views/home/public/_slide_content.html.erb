<% if slide.imagen.attached? %>
  <% 
    begin
      # Usamos la imagen original para máxima calidad
      original_img = url_for(slide.imagen)
      
      # Versiones responsive
      mobile_img = url_for(slide.imagen.variant(resize_to_limit: [800, 220]))
      tablet_img = url_for(slide.imagen.variant(resize_to_limit: [1200, 330]))
      desktop_img = url_for(slide.imagen.variant(resize_to_limit: [1600, 440]))
      
      # WebP para navegadores modernos
      if defined?(ImageProcessing::Vips)
        webp_original = url_for(slide.imagen.variant(format: :webp, saver: { quality: 85 }))
        webp_desktop = url_for(slide.imagen.variant(format: :webp, resize_to_limit: [1600, 440], saver: { quality: 80 }))
      end
  %>
  <picture>
    <!-- WebP (opcional) -->
    <% if defined?(ImageProcessing::Vips) %>
      <source type="image/webp" 
              media="(min-width: 1600px)" 
              srcset="<%= webp_original %>">
      <source type="image/webp" 
              media="(min-width: 1200px)" 
              srcset="<%= webp_desktop %>">
    <% end %>
    
    <!-- Imágenes estándar -->
    <source media="(min-width: 1600px)" 
            srcset="<%= original_img %>">
    <source media="(min-width: 1200px)" 
            srcset="<%= desktop_img %>">
    <source media="(min-width: 800px)" 
            srcset="<%= tablet_img %>">
    
    <!-- Imagen por defecto -->
    <%= image_tag mobile_img,
          class: "d-block",
          alt: slide.nombre.presence || "Contenido promocional",
          loading: "lazy",
          decoding: "async",
          sizes: "(max-width: 799px) 800px, (max-width: 1199px) 1200px, (max-width: 1599px) 1600px, 1920px" %>
  </picture>
  <% rescue => e %>
    <div class="carousel-error-placeholder">
      <i class="bi bi-exclamation-triangle"></i>
      <small>Error al cargar: <%= e.message %></small>
    </div>
  <% end %>
<% else %>
  <div class="carousel-placeholder">
    <i class="bi bi-image"></i>
    <p>Imagen no disponible</p>
  </div>
<% end %>